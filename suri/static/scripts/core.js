Promise.withResolvers||(Promise.withResolvers=function(){var e,t,n=new this((function(n,r){e=n,t=r}));return{resolve:e,reject:t,promise:n}});const e=(e,t=document)=>t.querySelector(e),t=(e,t=document)=>[...t.querySelectorAll(e)],n=(e,t=document)=>{const n=(new XPathEvaluator).createExpression(e).evaluate(t,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),r=[];for(let e=0,{snapshotLength:t}=n;e<t;e++)r.push(n.snapshotItem(e));return r},r="object"==typeof self?self:globalThis,s=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),s=o=>{if(e.has(o))return e.get(o);const[a,i]=t[o];switch(a){case 0:case-1:return n(i,o);case 1:{const e=n([],o);for(const t of i)e.push(s(t));return e}case 2:{const e=n({},o);for(const[t,n]of i)e[s(t)]=s(n);return e}case 3:return n(new Date(i),o);case 4:{const{source:e,flags:t}=i;return n(new RegExp(e,t),o)}case 5:{const e=n(new Map,o);for(const[t,n]of i)e.set(s(t),s(n));return e}case 6:{const e=n(new Set,o);for(const t of i)e.add(s(t));return e}case 7:{const{name:e,message:t}=i;return n(new r[e](t),o)}case 8:return n(BigInt(i),o);case"BigInt":return n(Object(BigInt(i)),o)}return n(new r[a](i),o)};return s})(new Map,e)(0),o="",{toString:a}={},{keys:i}=Object,l=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=a.call(e).slice(8,-1);switch(n){case"Array":return[1,o];case"Object":return[2,o];case"Date":return[3,o];case"RegExp":return[4,o];case"Map":return[5,o];case"Set":return[6,o]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},c=([e,t])=>0===e&&("function"===t||"symbol"===t),f=(e,{json:t,lossy:n}={})=>{const r=[];return((e,t,n,r)=>{const s=(e,t)=>{const s=r.push(e)-1;return n.set(t,s),s},o=r=>{if(n.has(r))return n.get(r);let[a,f]=l(r);switch(a){case 0:{let t=r;switch(f){case"bigint":a=8,t=r.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+f);t=null;break;case"undefined":return s([-1],r)}return s([a,t],r)}case 1:{if(f)return s([f,[...r]],r);const e=[],t=s([a,e],r);for(const t of r)e.push(o(t));return t}case 2:{if(f)switch(f){case"BigInt":return s([f,r.toString()],r);case"Boolean":case"Number":case"String":return s([f,r.valueOf()],r)}if(t&&"toJSON"in r)return o(r.toJSON());const n=[],u=s([a,n],r);for(const t of i(r))!e&&c(l(r[t]))||n.push([o(t),o(r[t])]);return u}case 3:return s([a,r.toISOString()],r);case 4:{const{source:e,flags:t}=r;return s([a,{source:e,flags:t}],r)}case 5:{const t=[],n=s([a,t],r);for(const[n,s]of r)(e||!c(l(n))&&!c(l(s)))&&t.push([o(n),o(s)]);return n}case 6:{const t=[],n=s([a,t],r);for(const n of r)!e&&c(l(n))||t.push(o(n));return n}}const{message:u}=r;return s([a,{name:f,message:u}],r)};return o})(!(t||n),!!t,new Map,r)(e),r},{parse:u,stringify:p}=JSON,d={json:!0,lossy:!0};var m=Object.freeze({__proto__:null,parse:e=>s(u(e)),stringify:e=>p(f(e,d))});const h="5f50bb1c-57c3-47af-b36a-392fe80f8803",y="M"+h,g="T"+h;var w=e=>({value:new Promise((t=>{let n=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");n.onmessage=t,n.postMessage(e)}))})
/*! (c) Andrea Giammarchi - ISC */;const{Int32Array:_,Map:b,SharedArrayBuffer:v,Uint16Array:E}=globalThis,{BYTES_PER_ELEMENT:j}=_,{BYTES_PER_ELEMENT:k}=E,{isArray:A}=Array,{notify:S,wait:$,waitAsync:P}=Atomics,{fromCharCode:x}=String,R=new WeakSet,M=new WeakMap,T={value:{then:e=>e()}},O=()=>{};let N=0;const W=(e,{parse:t=JSON.parse,stringify:n=JSON.stringify,transform:r,interrupt:s}=JSON)=>{if(!M.has(e)){const o=(t,...n)=>e.postMessage({[h]:n},{transfer:t}),a="function"==typeof s?s:s?.handler||O,i=s?.delay||42,l=(e,t)=>e?(P||w)(t,0):(((e,t,n)=>{for(;"timed-out"===$(e,0,0,t);)n()})(t,i,a),T);let c=!1;M.set(e,new Proxy(new b,{has:(e,t)=>"string"==typeof t&&!t.startsWith("_"),get:(n,s)=>"then"===s?null:(...n)=>{const a=N++;let i=new _(new v(j)),f=[];R.has(n.at(-1)||f)&&R.delete(f=n.pop()),o(f,a,i,s,r?n.map(r):n);const u=e!==globalThis;let p=0;return c&&u&&(p=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${s}(...args) is awaited`)),l(u,i).value.then((()=>{clearTimeout(p);const e=i[0];if(!e)return;const n=k*e;return i=new _(new v(n+n%j)),o([],a,i),l(u,i).value.then((()=>t(x(...new E(i.buffer).slice(0,e)))))}))},set(t,s,o){if(!t.size){const s=new b;e.addEventListener("message",(async e=>{const o=e.data?.[h];if(A(o)){e.stopImmediatePropagation();const[a,i,...l]=o;if(l.length){const[e,o]=l;if(!t.has(e))throw new Error(`Unsupported action: ${e}`);c=!0;try{const l=await t.get(e)(...o);if(void 0!==l){const e=n(r?r(l):l);s.set(a,e),i[0]=e.length}}finally{c=!1}}else{const e=s.get(a);s.delete(a);for(let t=new E(i.buffer),n=0;n<e.length;n++)t[n]=e.charCodeAt(n)}S(i,0)}}))}return!!t.set(s,o)}}))}return M.get(e)};W.transfer=(...e)=>(R.add(e),e);const I="object",C="function",F="number",L="string",B="undefined",J="symbol",{defineProperty:D,getOwnPropertyDescriptor:H,getPrototypeOf:U,isExtensible:q,ownKeys:X,preventExtensions:z,set:Y,setPrototypeOf:G}=Reflect,{assign:V,create:K}=Object,Z=U(Int8Array),Q="isArray",ee=(e,t)=>{const{get:n,set:r,value:s}=e;return n&&(e.get=t(n)),r&&(e.set=t(r)),s&&(e.value=t(s)),e},te=(e,t)=>[e,t],ne=e=>t=>{const n=typeof t;switch(n){case I:if(null==t)return te("null",t);if(t===globalThis)return te(I,null);case C:return e(n,t);case"boolean":case F:case L:case B:case"bigint":return te(n,t);case J:if(re.has(t))return te(n,re.get(t))}throw new Error(`Unable to handle this ${n} type`)},re=new Map(X(Symbol).filter((e=>typeof Symbol[e]===J)).map((e=>[Symbol[e],e]))),se=e=>{for(const[t,n]of re)if(n===e)return t};function oe(){return this}const ae="apply",ie="construct",le="defineProperty",ce="deleteProperty",fe="get",ue="getOwnPropertyDescriptor",pe="getPrototypeOf",de="has",me="isExtensible",he="ownKeys",ye="preventExtensions",ge="set",we="setPrototypeOf",_e="delete";var be=((e,t)=>{const n=t&&new WeakMap;if(t){const{addEventListener:e}=EventTarget.prototype;D(EventTarget.prototype,"addEventListener",{value(t,r,...s){return s.at(0)?.invoke&&(n.has(this)||n.set(this,new Map),n.get(this).set(t,[].concat(s[0].invoke)),delete s[0].invoke),e.call(this,t,r,...s)}})}const r=t&&(e=>{const{currentTarget:t,target:r,type:s}=e;for(const o of n.get(t||r)?.get(s)||[])e[o]()});return(n,s,o,...a)=>{let i=0;const l=new Map,c=new Map,{[o]:f}=n,u=a.length?V(K(globalThis),...a):globalThis,p=ne(((e,t)=>{if(!l.has(t)){let e;for(;c.has(e=i++););l.set(t,e),c.set(e,t)}return te(e,l.get(t))})),d=new FinalizationRegistry((e=>{f(_e,te(L,e))})),m=([e,n])=>{switch(e){case I:if(null==n)return u;if(typeof n===F)return c.get(n);if(!(n instanceof Z))for(const e in n)n[e]=m(n[e]);return n;case C:if(typeof n===L){if(!c.has(n)){const e=function(...e){return t&&e.at(0)instanceof Event&&r(...e),f(ae,te(C,n),p(this),e.map(p))},s=new WeakRef(e);c.set(n,s),d.register(e,n,s)}return c.get(n).deref()}return c.get(n);case J:return se(n)}return n},h={[ae]:(e,t,n)=>p(e.apply(t,n)),[ie]:(e,t)=>p(new e(...t)),[le]:(e,t,n)=>p(D(e,t,n)),[ce]:(e,t)=>p(delete e[t]),[pe]:e=>p(U(e)),[fe]:(e,t)=>p(e[t]),[ue]:(e,t)=>{const n=H(e,t);return n?te(I,ee(n,p)):te(B,n)},[de]:(e,t)=>p(t in e),[me]:e=>p(q(e)),[he]:e=>te(I,X(e).map(p)),[ye]:e=>p(z(e)),[ge]:(e,t,n)=>p(Y(e,t,n)),[we]:(e,t)=>p(G(e,t)),[_e](e){l.delete(c.get(e)),c.delete(e)}};return n[s]=(e,t,...n)=>{switch(e){case ae:n[0]=m(n[0]),n[1]=n[1].map(m);break;case ie:n[0]=n[0].map(m);break;case le:{const[e,t]=n;n[0]=m(e);const{get:r,set:s,value:o}=t;r&&(t.get=m(r)),s&&(t.set=m(s)),o&&(t.value=m(o));break}default:n=n.map(m)}return h[e](m(t),...n)},{proxy:n,[e.toLowerCase()]:u,[`is${e}Proxy`]:()=>!1}}})("Window",!0),ve=(e=>{let t=0;const n=new Map,r=new Map,s=Symbol(),o=e=>typeof e===C?e():e,a=e=>typeof e===I&&!!e&&s in e,i=Array[Q],l=ne(((e,a)=>{if(s in a)return o(a[s]);if(e===C){if(!r.has(a)){let e;for(;r.has(e=String(t++)););n.set(a,e),r.set(e,a)}return te(e,n.get(a))}if(!(a instanceof Z))for(const e in a)a[e]=l(a[e]);return te(e,a)}));return(t,c,f)=>{const{[c]:u}=t,p=new Map,d=new FinalizationRegistry((e=>{p.delete(e),u(_e,l(e))})),m=e=>{const[t,n]=e;if(!p.has(n)){const r=t===C?oe.bind(e):e,s=new Proxy(r,g),o=new WeakRef(s);p.set(n,o),d.register(s,n,o)}return p.get(n).deref()},h=e=>{const[t,n]=e;switch(t){case I:return null===n?globalThis:typeof n===F?m(e):n;case C:return typeof n===L?r.get(n):m(e);case J:return se(n)}return n},y=(e,t,...n)=>h(u(e,o(t),...n)),g={[ae]:(e,t,n)=>y(ae,e,l(t),n.map(l)),[ie]:(e,t)=>y(ie,e,t.map(l)),[le]:(e,t,n)=>{const{get:r,set:s,value:o}=n;return typeof r===C&&(n.get=l(r)),typeof s===C&&(n.set=l(s)),typeof o===C&&(n.value=l(o)),y(le,e,l(t),n)},[ce]:(e,t)=>y(ce,e,l(t)),[pe]:e=>y(pe,e),[fe]:(e,t)=>t===s?e:y(fe,e,l(t)),[ue]:(e,t)=>{const n=y(ue,e,l(t));return n&&ee(n,h)},[de]:(e,t)=>t===s||y(de,e,l(t)),[me]:e=>y(me,e),[he]:e=>y(he,e).map(h),[ye]:e=>y(ye,e),[ge]:(e,t,n)=>y(ge,e,l(t),l(n)),[we]:(e,t)=>y(we,e,l(t))};t[f]=(e,t,s,o)=>{switch(e){case ae:return h(t).apply(h(s),o.map(h));case _e:{const e=h(t);n.delete(r.get(e)),r.delete(e)}}};const w=new Proxy([I,null],g),_=w.Array[Q];return D(Array,Q,{value:e=>a(e)?_(e):i(e)}),{[e.toLowerCase()]:w,[`is${e}Proxy`]:a,proxy:t}}})("Window"),Ee="function"==typeof Worker?Worker:class{};const je=new WeakMap,ke=(e,...t)=>{const n=W(e,...t);if(!je.has(n)){const t=e instanceof Ee?be:ve;je.set(n,t(n,y,g))}return je.get(n)};ke.transfer=W.transfer;const Ae=e=>e.arrayBuffer(),Se=e=>e.json(),$e=e=>e.text();const Pe={object(...e){return this.string(function(e){for(var t=e[0],n=1,r=arguments.length;n<r;n++)t+=arguments[n]+e[n];return t}(...e))},string(e){for(const t of e.split(/[\r\n]+/))if(t.trim().length){/^(\s+)/.test(t)&&(e=e.replace(new RegExp("^"+RegExp.$1,"gm"),""));break}return e}},xe=(e,...t)=>Pe[typeof e](e,...t),{replace:Re}="",Me=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g,Te={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},Oe=e=>Te[e],Ne=e=>Re.call(e,Me,Oe),{isArray:We}=Array,{assign:Ie,create:Ce,defineProperties:Fe,defineProperty:Le,entries:Be}=Object,{all:Je,resolve:De}=new Proxy(Promise,{get:(e,t)=>e[t].bind(e)}),He=(e,t=location.href)=>new URL(e,t.replace(/^blob:/,"")).href;let Ue=0;const qe=(e,t)=>({id:e.id||(e.id=`${t}-w${Ue++}`),tag:e.tagName}),Xe=(e,t,n=!1,r=CustomEvent)=>{e.dispatchEvent(new r(`${t}:ready`,{bubbles:!0,detail:{worker:n}}))},ze=new WeakMap,Ye=e=>{const t=e||console,n={stderr:(t.stderr||console.error).bind(t),stdout:(t.stdout||console.log).bind(t)};return{stderr:(...e)=>n.stderr(...e),stdout:(...e)=>n.stdout(...e),async get(e){const t=await e;return ze.set(t,n),t}}},Ge=({FS:e,PATH:t,PATH_FS:n},r,s)=>{const o=n.resolve(r);return e.mkdirTree(t.dirname(o)),e.writeFile(o,new Uint8Array(s),{canOwn:!0})},Ve=e=>{const t=e.split("/");return t.pop(),t.join("/")},Ke=(e,t)=>{const n=[];for(const r of t.split("/"))"."!==r&&(n.push(r),r&&e.mkdir(n.join("/")))},Ze=(e,t)=>{const n=[];for(const e of t.split("/"))switch(e){case"":case".":break;case"..":n.pop();break;default:n.push(e)}return[e.cwd()].concat(n).join("/").replace(/^\/+/,"/")},Qe=e=>{const t=e.map((e=>e.trim().replace(/(^[/]*|[/]*$)/g,""))).filter((e=>""!==e&&"."!==e)).join("/");return e[0].startsWith("/")?`/${t}`:t},et=(e,t)=>fetch(He(t,tt.get(e))),tt=new WeakMap,nt=(e,t,n)=>Je((e=>{for(const{files:t,to_file:n,from:r=""}of e){if(void 0!==t&&void 0!==n)throw new Error("Cannot use 'to_file' and 'files' parameters together!");if(void 0===t&&void 0===n&&r.endsWith("/"))throw new Error(`Couldn't determine the filename from the path ${r}, please supply 'to_file' parameter.`)}return e.flatMap((({from:e="",to_folder:t=".",to_file:n,files:r})=>{if(We(r))return r.map((n=>({url:Qe([e,n]),path:Qe([t,n])})));const s=n||e.slice(1+e.lastIndexOf("/"));return[{url:e,path:Qe([t,s])}]}))})(n).map((({url:r,path:s})=>et(n,r).then(Ae).then((n=>e.writeFile(t,s,n)))))),rt=(e,t)=>t.endsWith("/")?`${t}${e.split("/").pop()}`:t,st=(e,t)=>e.replace(/\{.+?\}/g,(e=>{if(!t.has(e))throw new SyntaxError(`Invalid template: ${e}`);return t.get(e)})),ot=(e,t,n)=>Je((e=>{const t=new Map,n=new Set,r=[];for(const[s,o]of Object.entries(e))if(/^\{.+\}$/.test(s)){if(t.has(s))throw new SyntaxError(`Duplicated template: ${s}`);t.set(s,st(o,t))}else{const e=st(s,t),a=rt(e,st(o,t));if(n.has(a))throw new SyntaxError(`Duplicated destination: ${a}`);n.add(a),r.push({url:e,path:a})}return r})(n).map((({url:r,path:s})=>et(n,r).then(Ae).then((n=>e.writeFile(t,s,n)))))),at=(e,t,n)=>{e.registerJsModule(t,n)},it=(e,t,...n)=>{try{return e.runPython(xe(t),...n)}catch(t){ze.get(e).stderr(t)}},lt=async(e,t,...n)=>{try{return await e.runPythonAsync(xe(t),...n)}catch(t){ze.get(e).stderr(t)}},ct=async(e,t,n)=>{const[r,...s]=t.split(".");let o,a=e.globals.get(r);for(const e of s)[o,a]=[a,a[e]];try{await a.call(o,n)}catch(t){ze.get(e).stderr(t)}};var ft={type:"micropython",module:(e="1.20.0-297")=>`https://cdn.jsdelivr.net/npm/@micropython/micropython-webassembly-pyscript@${e}/micropython.mjs`,async engine({loadMicroPython:e},t,n){const{stderr:r,stdout:s,get:o}=Ye();n=n.replace(/\.m?js$/,".wasm");const a=await o(e({stderr:r,stdout:s,url:n}));return t.files&&await ot(this,a,t.files),t.fetch&&await nt(this,a,t.fetch),a},registerJSModule:at,run:it,runAsync:lt,runEvent:ct,transform:(e,t)=>t,writeFile:({FS:e,_module:{PATH:t,PATH_FS:n}},r,s)=>Ge({FS:e,PATH:t,PATH_FS:n},r,s)};const ut={dict_converter:Object.fromEntries};var pt={type:"pyodide",module:(e="0.24.1")=>`https://cdn.jsdelivr.net/pyodide/v${e}/full/pyodide.mjs`,async engine({loadPyodide:e},t,n){const{stderr:r,stdout:s,get:o}=Ye(),a=n.slice(0,n.lastIndexOf("/")),i=await o(e({stderr:r,stdout:s,indexURL:a}));if(t.files&&await ot(this,i,t.files),t.fetch&&await nt(this,i,t.fetch),t.packages){await i.loadPackage("micropip");const e=await i.pyimport("micropip");await e.install(t.packages),e.destroy()}return i},registerJSModule:at,run:it,runAsync:lt,runEvent:ct,transform:(e,t)=>t instanceof e.ffi.PyProxy?t.toJs(ut):t,writeFile:({FS:e,PATH:t,_module:{PATH_FS:n}},r,s)=>Ge({FS:e,PATH:t,PATH_FS:n},r,s)};const dt="ruby-wasm-wasi",mt=dt.replace(/\W+/g,"_");var ht={type:dt,experimental:!0,module:(e="2.1.0")=>`https://cdn.jsdelivr.net/npm/ruby-3_2-wasm-wasi@${e}/dist/browser.esm.js`,async engine({DefaultRubyVM:e},t,n){const r=await fetch(`${n.slice(0,n.lastIndexOf("/"))}/ruby.wasm`),s=await WebAssembly.compile(await r.arrayBuffer()),{vm:o}=await e(s);return t.files&&await ot(this,o,t.files),t.fetch&&await nt(this,o,t.fetch),o},registerJSModule(e,t,n){const r=`__module_${mt}_${t}`;globalThis[r]=n,this.run(e,`require "js";$${t}=JS.global[:${r}]`),delete globalThis[r]},run:(e,t,...n)=>e.eval(xe(t),...n),runAsync:(e,t,...n)=>e.evalAsync(xe(t),...n),async runEvent(e,t,n){if(/^xworker\.(on\w+)$/.test(t)){const{$1:t}=RegExp,r=`__module_${mt}_event`;globalThis[r]=n,this.run(e,`require "js";$xworker.call("${t}",JS.global[:${r}])`),delete globalThis[r]}else{const r=this.run(e,`method(:${t})`);await r.call(t,e.wrap(n))}},transform:(e,t)=>t,writeFile:()=>{throw new Error(`writeFile is not supported in ${dt}`)}};var yt={type:"wasmoon",module:(e="1.15.0")=>`https://cdn.jsdelivr.net/npm/wasmoon@${e}/+esm`,async engine({LuaFactory:e,LuaLibraries:t},n){const{stderr:r,stdout:s,get:o}=Ye(),a=await o((new e).createEngine());return a.global.getTable(t.Base,(e=>{a.global.setField(e,"print",s),a.global.setField(e,"printErr",r)})),n.files&&await ot(this,a,n.files),n.fetch&&await nt(this,a,n.fetch),a},registerJSModule:(e,t,n)=>{e.global.set(t,n)},run:(e,t,...n)=>{try{return e.doStringSync(xe(t),...n)}catch(t){ze.get(e).stderr(t)}},runAsync:async(e,t,...n)=>{try{return await e.doString(xe(t),...n)}catch(t){ze.get(e).stderr(t)}},runEvent:async(e,t,n)=>{const[r,...s]=t.split(".");let o,a=e.global.get(r);for(const e of s)[o,a]=[a,a[e]];try{await a.call(o,n)}catch(t){ze.get(e).stderr(t)}},transform:(e,t)=>t,writeFile:({cmodule:{module:{FS:e}}},t,n)=>((e,t,n)=>(Ke(e,Ve(t)),t=Ze(e,t),e.writeFile(t,new Uint8Array(n),{canOwn:!0})))(e,t,n)};const gt=new Map,wt=new Map,_t=[],bt=[],vt=new Proxy(new Map,{get(e,t){if(!e.has(t)){const[n,...r]=t.split("@"),s=gt.get(n),o=/^https?:\/\//i.test(r)?r.join("@"):s.module(...r);e.set(t,{url:o,module:import(o),engine:s.engine.bind(s)})}const{url:n,module:r,engine:s}=e.get(t);return(e,o)=>r.then((r=>{wt.set(t,e);for(const t of["files","fetch"]){const n=e?.[t];n&&tt.set(n,o)}return s(r,e,n)}))}}),Et=e=>{for(const t of[].concat(e.type))gt.set(t,e),_t.push(`script[type="${t}"]`),bt.push(`${t}-`)};for(const e of[ft,pt,ht,yt])Et(e);const jt=async e=>(await import("https://cdn.jsdelivr.net/npm/basic-toml@0.3.1/es.js")).parse(e),kt=e=>{let t=typeof e;return"string"===t&&/\.(json|toml|txt)$/.test(e)?t=RegExp.$1:e="./config.txt",[He(e),t]},At=(e,t,n={})=>{if(t){const[e,r]=kt(t);if("json"===r)n=fetch(e).then(Se);else if("toml"===r)n=fetch(e).then($e).then(jt);else if("string"===r)try{n=JSON.parse(t)}catch(e){n=jt(t)}else"object"===r&&t&&(n=t);t=e}return De(n).then((n=>vt[e](n,t)))},St=(e,t="")=>`${e}@${t}`.replace(/@$/,""),$t=[["beforeRun","codeBeforeRunWorker"],["beforeRunAsync","codeBeforeRunWorkerAsync"],["afterRun","codeAfterRunWorker"],["afterRunAsync","codeAfterRunWorkerAsync"]];class Pt{constructor(e,t){this.interpreter=e,this.onWorkerReady=t.onWorkerReady;for(const[e,n]of $t)this[e]=t[n]}get stringHooks(){const e={};for(const[t]of $t)this[t]&&(e[t]=xe(this[t]()));return e}}var xt=(...e)=>function(t,n){const r=new Worker(URL.createObjectURL(new Blob(['const e="object"==typeof self?self:globalThis,t=t=>((t,r)=>{const n=(e,r)=>(t.set(r,e),e),s=o=>{if(t.has(o))return t.get(o);const[a,i]=r[o];switch(a){case 0:case-1:return n(i,o);case 1:{const e=n([],o);for(const t of i)e.push(s(t));return e}case 2:{const e=n({},o);for(const[t,r]of i)e[s(t)]=s(r);return e}case 3:return n(new Date(i),o);case 4:{const{source:e,flags:t}=i;return n(new RegExp(e,t),o)}case 5:{const e=n(new Map,o);for(const[t,r]of i)e.set(s(t),s(r));return e}case 6:{const e=n(new Set,o);for(const t of i)e.add(s(t));return e}case 7:{const{name:t,message:r}=i;return n(new e[t](r),o)}case 8:return n(BigInt(i),o);case"BigInt":return n(Object(BigInt(i)),o)}return n(new e[a](i),o)};return s})(new Map,t)(0),r="",{toString:n}={},{keys:s}=Object,o=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const s=n.call(e).slice(8,-1);switch(s){case"Array":return[1,r];case"Object":return[2,r];case"Date":return[3,r];case"RegExp":return[4,r];case"Map":return[5,r];case"Set":return[6,r]}return s.includes("Array")?[1,s]:s.includes("Error")?[7,s]:[2,s]},a=([e,t])=>0===e&&("function"===t||"symbol"===t),i=(e,{json:t,lossy:r}={})=>{const n=[];return((e,t,r,n)=>{const i=(e,t)=>{const s=n.push(e)-1;return r.set(t,s),s},c=n=>{if(r.has(n))return r.get(n);let[l,u]=o(n);switch(l){case 0:{let t=n;switch(u){case"bigint":l=8,t=n.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+u);t=null;break;case"undefined":return i([-1],n)}return i([l,t],n)}case 1:{if(u)return i([u,[...n]],n);const e=[],t=i([l,e],n);for(const t of n)e.push(c(t));return t}case 2:{if(u)switch(u){case"BigInt":return i([u,n.toString()],n);case"Boolean":case"Number":case"String":return i([u,n.valueOf()],n)}if(t&&"toJSON"in n)return c(n.toJSON());const r=[],f=i([l,r],n);for(const t of s(n))!e&&a(o(n[t]))||r.push([c(t),c(n[t])]);return f}case 3:return i([l,n.toISOString()],n);case 4:{const{source:e,flags:t}=n;return i([l,{source:e,flags:t}],n)}case 5:{const t=[],r=i([l,t],n);for(const[r,s]of n)(e||!a(o(r))&&!a(o(s)))&&t.push([c(r),c(s)]);return r}case 6:{const t=[],r=i([l,t],n);for(const r of n)!e&&a(o(r))||t.push(c(r));return r}}const{message:f}=n;return i([l,{name:u,message:f}],n)};return c})(!(t||r),!!t,new Map,n)(e),n},{parse:c,stringify:l}=JSON,u={json:!0,lossy:!0};var f=Object.freeze({__proto__:null,parse:e=>t(c(e)),stringify:e=>l(i(e,u))});const p="5f50bb1c-57c3-47af-b36a-392fe80f8803",d="M"+p,g="T"+p;var y=e=>({value:new Promise((t=>{let r=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");r.onmessage=t,r.postMessage(e)}))})\n/*! (c) Andrea Giammarchi - ISC */;const{Int32Array:h,Map:w,SharedArrayBuffer:m,Uint16Array:b}=globalThis,{BYTES_PER_ELEMENT:v}=h,{BYTES_PER_ELEMENT:S}=b,{isArray:E}=Array,{notify:P,wait:$,waitAsync:A}=Atomics,{fromCharCode:M}=String,j=new WeakSet,x=new WeakMap,k={value:{then:e=>e()}},T=()=>{};let _=0;const O=(e,{parse:t=JSON.parse,stringify:r=JSON.stringify,transform:n,interrupt:s}=JSON)=>{if(!x.has(e)){const o=(t,...r)=>e.postMessage({[p]:r},{transfer:t}),a="function"==typeof s?s:s?.handler||T,i=s?.delay||42,c=(e,t)=>e?(A||y)(t,0):(((e,t,r)=>{for(;"timed-out"===$(e,0,0,t);)r()})(t,i,a),k);let l=!1;x.set(e,new Proxy(new w,{has:(e,t)=>"string"==typeof t&&!t.startsWith("_"),get:(r,s)=>"then"===s?null:(...r)=>{const a=_++;let i=new h(new m(v)),u=[];j.has(r.at(-1)||u)&&j.delete(u=r.pop()),o(u,a,i,s,n?r.map(n):r);const f=e!==globalThis;let p=0;return l&&f&&(p=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${s}(...args) is awaited`)),c(f,i).value.then((()=>{clearTimeout(p);const e=i[0];if(!e)return;const r=S*e;return i=new h(new m(r+r%v)),o([],a,i),c(f,i).value.then((()=>t(M(...new b(i.buffer).slice(0,e)))))}))},set(t,s,o){if(!t.size){const s=new w;e.addEventListener("message",(async e=>{const o=e.data?.[p];if(E(o)){e.stopImmediatePropagation();const[a,i,...c]=o;if(c.length){const[e,o]=c;if(!t.has(e))throw new Error(`Unsupported action: ${e}`);l=!0;try{const c=await t.get(e)(...o);if(void 0!==c){const e=r(n?n(c):c);s.set(a,e),i[0]=e.length}}finally{l=!1}}else{const e=s.get(a);s.delete(a);for(let t=new b(i.buffer),r=0;r<e.length;r++)t[r]=e.charCodeAt(r)}P(i,0)}}))}return!!t.set(s,o)}}))}return x.get(e)};O.transfer=(...e)=>(j.add(e),e);const F="object",R="function",W="number",J="string",B="undefined",I="symbol",{defineProperty:C,getOwnPropertyDescriptor:L,getPrototypeOf:D,isExtensible:N,ownKeys:H,preventExtensions:U,set:z,setPrototypeOf:q}=Reflect,{assign:K,create:Y}=Object,G=D(Int8Array),V="isArray",Q=(e,t)=>{const{get:r,set:n,value:s}=e;return r&&(e.get=t(r)),n&&(e.set=t(n)),s&&(e.value=t(s)),e},X=(e,t)=>[e,t],Z=e=>t=>{const r=typeof t;switch(r){case F:if(null==t)return X("null",t);if(t===globalThis)return X(F,null);case R:return e(r,t);case"boolean":case W:case J:case B:case"bigint":return X(r,t);case I:if(ee.has(t))return X(r,ee.get(t))}throw new Error(`Unable to handle this ${r} type`)},ee=new Map(H(Symbol).filter((e=>typeof Symbol[e]===I)).map((e=>[Symbol[e],e]))),te=e=>{for(const[t,r]of ee)if(r===e)return t};function re(){return this}const ne="apply",se="construct",oe="defineProperty",ae="deleteProperty",ie="get",ce="getOwnPropertyDescriptor",le="getPrototypeOf",ue="has",fe="isExtensible",pe="ownKeys",de="preventExtensions",ge="set",ye="setPrototypeOf",he="delete";var we=((e,t)=>{const r=t&&new WeakMap;if(t){const{addEventListener:e}=EventTarget.prototype;C(EventTarget.prototype,"addEventListener",{value(t,n,...s){return s.at(0)?.invoke&&(r.has(this)||r.set(this,new Map),r.get(this).set(t,[].concat(s[0].invoke)),delete s[0].invoke),e.call(this,t,n,...s)}})}const n=t&&(e=>{const{currentTarget:t,target:n,type:s}=e;for(const o of r.get(t||n)?.get(s)||[])e[o]()});return(r,s,o,...a)=>{let i=0;const c=new Map,l=new Map,{[o]:u}=r,f=a.length?K(Y(globalThis),...a):globalThis,p=Z(((e,t)=>{if(!c.has(t)){let e;for(;l.has(e=i++););c.set(t,e),l.set(e,t)}return X(e,c.get(t))})),d=new FinalizationRegistry((e=>{u(he,X(J,e))})),g=([e,r])=>{switch(e){case F:if(null==r)return f;if(typeof r===W)return l.get(r);if(!(r instanceof G))for(const e in r)r[e]=g(r[e]);return r;case R:if(typeof r===J){if(!l.has(r)){const e=function(...e){return t&&e.at(0)instanceof Event&&n(...e),u(ne,X(R,r),p(this),e.map(p))},s=new WeakRef(e);l.set(r,s),d.register(e,r,s)}return l.get(r).deref()}return l.get(r);case I:return te(r)}return r},y={[ne]:(e,t,r)=>p(e.apply(t,r)),[se]:(e,t)=>p(new e(...t)),[oe]:(e,t,r)=>p(C(e,t,r)),[ae]:(e,t)=>p(delete e[t]),[le]:e=>p(D(e)),[ie]:(e,t)=>p(e[t]),[ce]:(e,t)=>{const r=L(e,t);return r?X(F,Q(r,p)):X(B,r)},[ue]:(e,t)=>p(t in e),[fe]:e=>p(N(e)),[pe]:e=>X(F,H(e).map(p)),[de]:e=>p(U(e)),[ge]:(e,t,r)=>p(z(e,t,r)),[ye]:(e,t)=>p(q(e,t)),[he](e){c.delete(l.get(e)),l.delete(e)}};return r[s]=(e,t,...r)=>{switch(e){case ne:r[0]=g(r[0]),r[1]=r[1].map(g);break;case se:r[0]=r[0].map(g);break;case oe:{const[e,t]=r;r[0]=g(e);const{get:n,set:s,value:o}=t;n&&(t.get=g(n)),s&&(t.set=g(s)),o&&(t.value=g(o));break}default:r=r.map(g)}return y[e](g(t),...r)},{proxy:r,[e.toLowerCase()]:f,[`is${e}Proxy`]:()=>!1}}})("Window",!0),me=(e=>{let t=0;const r=new Map,n=new Map,s=Symbol(),o=e=>typeof e===R?e():e,a=e=>typeof e===F&&!!e&&s in e,i=Array[V],c=Z(((e,a)=>{if(s in a)return o(a[s]);if(e===R){if(!n.has(a)){let e;for(;n.has(e=String(t++)););r.set(a,e),n.set(e,a)}return X(e,r.get(a))}if(!(a instanceof G))for(const e in a)a[e]=c(a[e]);return X(e,a)}));return(t,l,u)=>{const{[l]:f}=t,p=new Map,d=new FinalizationRegistry((e=>{p.delete(e),f(he,c(e))})),g=e=>{const[t,r]=e;if(!p.has(r)){const n=t===R?re.bind(e):e,s=new Proxy(n,w),o=new WeakRef(s);p.set(r,o),d.register(s,r,o)}return p.get(r).deref()},y=e=>{const[t,r]=e;switch(t){case F:return null===r?globalThis:typeof r===W?g(e):r;case R:return typeof r===J?n.get(r):g(e);case I:return te(r)}return r},h=(e,t,...r)=>y(f(e,o(t),...r)),w={[ne]:(e,t,r)=>h(ne,e,c(t),r.map(c)),[se]:(e,t)=>h(se,e,t.map(c)),[oe]:(e,t,r)=>{const{get:n,set:s,value:o}=r;return typeof n===R&&(r.get=c(n)),typeof s===R&&(r.set=c(s)),typeof o===R&&(r.value=c(o)),h(oe,e,c(t),r)},[ae]:(e,t)=>h(ae,e,c(t)),[le]:e=>h(le,e),[ie]:(e,t)=>t===s?e:h(ie,e,c(t)),[ce]:(e,t)=>{const r=h(ce,e,c(t));return r&&Q(r,y)},[ue]:(e,t)=>t===s||h(ue,e,c(t)),[fe]:e=>h(fe,e),[pe]:e=>h(pe,e).map(y),[de]:e=>h(de,e),[ge]:(e,t,r)=>h(ge,e,c(t),c(r)),[ye]:(e,t)=>h(ye,e,c(t))};t[u]=(e,t,s,o)=>{switch(e){case ne:return y(t).apply(y(s),o.map(y));case he:{const e=y(t);r.delete(n.get(e)),n.delete(e)}}};const m=new Proxy([F,null],w),b=m.Array[V];return C(Array,V,{value:e=>a(e)?b(e):i(e)}),{[e.toLowerCase()]:m,[`is${e}Proxy`]:a,proxy:t}}})("Window"),be="function"==typeof Worker?Worker:class{};const ve=new WeakMap,Se=(e,...t)=>{const r=O(e,...t);if(!ve.has(r)){const t=e instanceof be?we:me;ve.set(r,t(r,d,g))}return ve.get(r)};Se.transfer=O.transfer;const Ee={object(...e){return this.string(function(e){for(var t=e[0],r=1,n=arguments.length;r<n;r++)t+=arguments[r]+e[r];return t}(...e))},string(e){for(const t of e.split(/[\\r\\n]+/))if(t.trim().length){/^(\\s+)/.test(t)&&(e=e.replace(new RegExp("^"+RegExp.$1,"gm"),""));break}return e}},Pe=(e,...t)=>Ee[typeof e](e,...t),{isArray:$e}=Array,{assign:Ae,create:Me,defineProperties:je,defineProperty:xe,entries:ke}=Object,{all:Te,resolve:_e}=new Proxy(Promise,{get:(e,t)=>e[t].bind(e)}),Oe=(e,t=location.href)=>new URL(e,t.replace(/^blob:/,"")).href,Fe=(e,t,r=!1,n=CustomEvent)=>{e.dispatchEvent(new n(`${t}:ready`,{bubbles:!0,detail:{worker:r}}))};Promise.withResolvers||(Promise.withResolvers=function(){var e,t,r=new this((function(r,n){e=r,t=n}));return{resolve:e,reject:t,promise:r}});const Re=e=>e.arrayBuffer(),We=e=>e.json(),Je=e=>e.text(),Be=new WeakMap,Ie=e=>{const t=e||console,r={stderr:(t.stderr||console.error).bind(t),stdout:(t.stdout||console.log).bind(t)};return{stderr:(...e)=>r.stderr(...e),stdout:(...e)=>r.stdout(...e),async get(e){const t=await e;return Be.set(t,r),t}}},Ce=({FS:e,PATH:t,PATH_FS:r},n,s)=>{const o=r.resolve(n);return e.mkdirTree(t.dirname(o)),e.writeFile(o,new Uint8Array(s),{canOwn:!0})},Le=e=>{const t=e.split("/");return t.pop(),t.join("/")},De=(e,t)=>{const r=[];for(const n of t.split("/"))"."!==n&&(r.push(n),n&&e.mkdir(r.join("/")))},Ne=(e,t)=>{const r=[];for(const e of t.split("/"))switch(e){case"":case".":break;case"..":r.pop();break;default:r.push(e)}return[e.cwd()].concat(r).join("/").replace(/^\\/+/,"/")},He=e=>{const t=e.map((e=>e.trim().replace(/(^[/]*|[/]*$)/g,""))).filter((e=>""!==e&&"."!==e)).join("/");return e[0].startsWith("/")?`/${t}`:t},Ue=(e,t)=>fetch(Oe(t,ze.get(e))),ze=new WeakMap,qe=(e,t,r)=>Te((e=>{for(const{files:t,to_file:r,from:n=""}of e){if(void 0!==t&&void 0!==r)throw new Error("Cannot use \'to_file\' and \'files\' parameters together!");if(void 0===t&&void 0===r&&n.endsWith("/"))throw new Error(`Couldn\'t determine the filename from the path ${n}, please supply \'to_file\' parameter.`)}return e.flatMap((({from:e="",to_folder:t=".",to_file:r,files:n})=>{if($e(n))return n.map((r=>({url:He([e,r]),path:He([t,r])})));const s=r||e.slice(1+e.lastIndexOf("/"));return[{url:e,path:He([t,s])}]}))})(r).map((({url:n,path:s})=>Ue(r,n).then(Re).then((r=>e.writeFile(t,s,r)))))),Ke=(e,t)=>t.endsWith("/")?`${t}${e.split("/").pop()}`:t,Ye=(e,t)=>e.replace(/\\{.+?\\}/g,(e=>{if(!t.has(e))throw new SyntaxError(`Invalid template: ${e}`);return t.get(e)})),Ge=(e,t,r)=>Te((e=>{const t=new Map,r=new Set,n=[];for(const[s,o]of Object.entries(e))if(/^\\{.+\\}$/.test(s)){if(t.has(s))throw new SyntaxError(`Duplicated template: ${s}`);t.set(s,Ye(o,t))}else{const e=Ye(s,t),a=Ke(e,Ye(o,t));if(r.has(a))throw new SyntaxError(`Duplicated destination: ${a}`);r.add(a),n.push({url:e,path:a})}return n})(r).map((({url:n,path:s})=>Ue(r,n).then(Re).then((r=>e.writeFile(t,s,r)))))),Ve=(e,t,r)=>{e.registerJsModule(t,r)},Qe=(e,t,...r)=>{try{return e.runPython(Pe(t),...r)}catch(t){Be.get(e).stderr(t)}},Xe=async(e,t,...r)=>{try{return await e.runPythonAsync(Pe(t),...r)}catch(t){Be.get(e).stderr(t)}},Ze=async(e,t,r)=>{const[n,...s]=t.split(".");let o,a=e.globals.get(n);for(const e of s)[o,a]=[a,a[e]];try{await a.call(o,r)}catch(t){Be.get(e).stderr(t)}};var et={type:"micropython",module:(e="1.20.0-297")=>`https://cdn.jsdelivr.net/npm/@micropython/micropython-webassembly-pyscript@${e}/micropython.mjs`,async engine({loadMicroPython:e},t,r){const{stderr:n,stdout:s,get:o}=Ie();r=r.replace(/\\.m?js$/,".wasm");const a=await o(e({stderr:n,stdout:s,url:r}));return t.files&&await Ge(this,a,t.files),t.fetch&&await qe(this,a,t.fetch),a},registerJSModule:Ve,run:Qe,runAsync:Xe,runEvent:Ze,transform:(e,t)=>t,writeFile:({FS:e,_module:{PATH:t,PATH_FS:r}},n,s)=>Ce({FS:e,PATH:t,PATH_FS:r},n,s)};const tt={dict_converter:Object.fromEntries};var rt={type:"pyodide",module:(e="0.24.1")=>`https://cdn.jsdelivr.net/pyodide/v${e}/full/pyodide.mjs`,async engine({loadPyodide:e},t,r){const{stderr:n,stdout:s,get:o}=Ie(),a=r.slice(0,r.lastIndexOf("/")),i=await o(e({stderr:n,stdout:s,indexURL:a}));if(t.files&&await Ge(this,i,t.files),t.fetch&&await qe(this,i,t.fetch),t.packages){await i.loadPackage("micropip");const e=await i.pyimport("micropip");await e.install(t.packages),e.destroy()}return i},registerJSModule:Ve,run:Qe,runAsync:Xe,runEvent:Ze,transform:(e,t)=>t instanceof e.ffi.PyProxy?t.toJs(tt):t,writeFile:({FS:e,PATH:t,_module:{PATH_FS:r}},n,s)=>Ce({FS:e,PATH:t,PATH_FS:r},n,s)};const nt="ruby-wasm-wasi",st=nt.replace(/\\W+/g,"_");var ot={type:nt,experimental:!0,module:(e="2.1.0")=>`https://cdn.jsdelivr.net/npm/ruby-3_2-wasm-wasi@${e}/dist/browser.esm.js`,async engine({DefaultRubyVM:e},t,r){const n=await fetch(`${r.slice(0,r.lastIndexOf("/"))}/ruby.wasm`),s=await WebAssembly.compile(await n.arrayBuffer()),{vm:o}=await e(s);return t.files&&await Ge(this,o,t.files),t.fetch&&await qe(this,o,t.fetch),o},registerJSModule(e,t,r){const n=`__module_${st}_${t}`;globalThis[n]=r,this.run(e,`require "js";$${t}=JS.global[:${n}]`),delete globalThis[n]},run:(e,t,...r)=>e.eval(Pe(t),...r),runAsync:(e,t,...r)=>e.evalAsync(Pe(t),...r),async runEvent(e,t,r){if(/^xworker\\.(on\\w+)$/.test(t)){const{$1:t}=RegExp,n=`__module_${st}_event`;globalThis[n]=r,this.run(e,`require "js";$xworker.call("${t}",JS.global[:${n}])`),delete globalThis[n]}else{const n=this.run(e,`method(:${t})`);await n.call(t,e.wrap(r))}},transform:(e,t)=>t,writeFile:()=>{throw new Error(`writeFile is not supported in ${nt}`)}};var at={type:"wasmoon",module:(e="1.15.0")=>`https://cdn.jsdelivr.net/npm/wasmoon@${e}/+esm`,async engine({LuaFactory:e,LuaLibraries:t},r){const{stderr:n,stdout:s,get:o}=Ie(),a=await o((new e).createEngine());return a.global.getTable(t.Base,(e=>{a.global.setField(e,"print",s),a.global.setField(e,"printErr",n)})),r.files&&await Ge(this,a,r.files),r.fetch&&await qe(this,a,r.fetch),a},registerJSModule:(e,t,r)=>{e.global.set(t,r)},run:(e,t,...r)=>{try{return e.doStringSync(Pe(t),...r)}catch(t){Be.get(e).stderr(t)}},runAsync:async(e,t,...r)=>{try{return await e.doString(Pe(t),...r)}catch(t){Be.get(e).stderr(t)}},runEvent:async(e,t,r)=>{const[n,...s]=t.split(".");let o,a=e.global.get(n);for(const e of s)[o,a]=[a,a[e]];try{await a.call(o,r)}catch(t){Be.get(e).stderr(t)}},transform:(e,t)=>t,writeFile:({cmodule:{module:{FS:e}}},t,r)=>((e,t,r)=>(De(e,Le(t)),t=Ne(e,t),e.writeFile(t,new Uint8Array(r),{canOwn:!0})))(e,t,r)};const it=new Map,ct=new Map,lt=new Proxy(new Map,{get(e,t){if(!e.has(t)){const[r,...n]=t.split("@"),s=it.get(r),o=/^https?:\\/\\//i.test(n)?n.join("@"):s.module(...n);e.set(t,{url:o,module:import(o),engine:s.engine.bind(s)})}const{url:r,module:n,engine:s}=e.get(t);return(e,o)=>n.then((n=>{ct.set(t,e);for(const t of["files","fetch"]){const r=e?.[t];r&&ze.set(r,o)}return s(n,e,r)}))}}),ut=e=>{for(const t of[].concat(e.type))it.set(t,e)};for(const e of[et,rt,ot,at])ut(e);const ft=async e=>(await import("https://cdn.jsdelivr.net/npm/basic-toml@0.3.1/es.js")).parse(e),pt=(e,t,r={})=>{if(t){const[e,n]=(e=>{let t=typeof e;return"string"===t&&/\\.(json|toml|txt)$/.test(e)?t=RegExp.$1:e="./config.txt",[Oe(e),t]})(t);if("json"===n)r=fetch(e).then(We);else if("toml"===n)r=fetch(e).then(Je).then(ft);else if("string"===n)try{r=JSON.parse(t)}catch(e){r=ft(t)}else"object"===n&&t&&(r=t);t=e}return _e(r).then((r=>lt[e](r,t)))};try{new SharedArrayBuffer(4)}catch(e){throw new Error(["Unable to use SharedArrayBuffer due insecure environment.","Please read requirements in MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer#security_requirements"].join("\\n"))}let dt,gt,yt;const ht=(e,t)=>{addEventListener(e,t||(async t=>{try{await dt,gt(`xworker.on${e}`,t)}catch(e){postMessage(e)}}),!!t&&{once:!0})},{parse:wt,stringify:mt}=f,{proxy:bt,window:vt,isWindowProxy:St}=Se(self,{parse:wt,stringify:mt,transform:e=>yt?yt(e):e}),Et={sync:bt,window:vt,isWindowProxy:St,onmessage:console.info,onerror:console.error,onmessageerror:console.warn,postMessage:postMessage.bind(self)};ht("message",(({data:{options:e,config:t,code:r,hooks:n}})=>{dt=(async()=>{try{const{id:s,tag:o,type:a,custom:i,version:c,config:l,async:u}=e,f=await pt(((e,t="")=>`${e}@${t}`.replace(/@$/,""))(a,c),t,l),p=Me(it.get(a)),d="run"+(u?"Async":"");if(n){const{beforeRun:e,beforeRunAsync:t,afterRun:r,afterRunAsync:s}=n,o=u?s:r,a=u?t:e;if(o){const e=p[d].bind(p);p[d]=(t,r,...n)=>e(t,`${r}\\n${o}`,...n)}if(a){const e=p[d].bind(p);p[d]=(t,r,...n)=>e(t,`${a}\\n${r}`,...n)}}const{CustomEvent:g,document:y}=vt,h=s&&y.getElementById(s)||null;let w="";return p.registerJSModule(f,"polyscript",{xworker:Et,get target(){return!w&&h&&("SCRIPT"===o?h.after(Ae(y.createElement(`script-${i||a}`),{id:w=`${s}-target`})):(w=s,h.replaceChildren(),h.style.display="block")),w}}),gt=p.runEvent.bind(p,f),yt=p.transform.bind(p,f),h&&Fe(h,i||a,!0,g),await p[d](f,r),f}catch(e){postMessage(e)}})(),ht("error"),ht("message"),ht("messageerror")}));\n'],{type:"application/javascript"})),{type:"module"}),{postMessage:s}=r,o=this instanceof Pt;if(e.length){const[t,r]=e;(n=Ie({},n||{type:t,version:r})).type||(n.type=t)}const[a]=kt(n.config),i=fetch(t).then($e).then((e=>{const t=o?this.stringHooks:void 0;s.call(r,{options:n,config:a,code:e,hooks:t})}));return Fe(r,{postMessage:{value:(e,...t)=>i.then((()=>s.call(r,e,...t)))},sync:{value:ke(r,m).proxy},onerror:{writable:!0,configurable:!0,value:console.error}}),o&&this.onWorkerReady?.(this.interpreter,r),r.addEventListener("message",(e=>{const{data:t}=e;t instanceof Error&&(e.stopImmediatePropagation(),r.onerror(Object.create(e,{type:{value:"error"},error:{value:t}})))})),r};const Rt="Invalid content";var Mt=e=>{const{src:t,worker:n}=e.attributes;if(n){let{value:r}=n;if(r)throw new SyntaxError("Invalid worker attribute");if(r=t?.value,!r){if(t)throw new SyntaxError("Invalid worker attribute");if(e.childElementCount){const{innerHTML:t,localName:n,type:s}=e,o=s||n.replace(/-script$/,"");r=Ne(t),console.warn(`Deprecated: use <script type="${o}"> for an always safe content parsing:\n`,r)}else r=e.textContent;return URL.createObjectURL(new Blob([xe(r)],{type:"text/plain"}))}return r}if(t&&e.textContent.replace(/\/\*[\s\S]*?\*\//g,"").replace(/^\s*(?:\/\/|#).*/gm,"").trim())throw new SyntaxError(Rt)};const Tt=(t,n)=>{const r=(e=>{let t=e;for(;t.parentNode;)t=t.parentNode;return t})(t);return r.getElementById(n)||e(n,r)},Ot=new WeakMap,Nt={get(){let e=Ot.get(this);return e||(e=document.createElement(`${this.type}-script`),Ot.set(this,e),Lt(this)),e},set(e){"string"==typeof e?Ot.set(this,Tt(this,e)):(Ot.set(this,e),Lt(this))}},Wt=new WeakMap,It=new Map,Ct=(e,t)=>{const n=e?.value;return n?t+n:""},Ft=(e,t,n,r,s,o=e)=>{if(!It.has(t)){const a={interpreter:At(n,s),queue:De(),XWorker:xt(e,r)};It.set(t,a),It.has(e)||It.set(e,a),It.has(o)||It.set(o,a)}return It.get(t)},Lt=async e=>{if(Wt.has(e)){const{target:t}=e;t&&(e.closest("head")?document.body.append(t):e.after(t))}else{const{attributes:{async:t,config:n,env:r,target:s,version:o},src:a,type:i}=e,l=o?.value,c=St(i,l);let f=Ct(n,"|");const u=Ct(r,"")||`${c}${f}`;f=f.slice(1);const p=Mt(e);if(p){const n=new(xt(i,l))(p,{...qe(e,i),async:!!t,config:f});return void Wt.set(Le(e,"xworker",{value:n}),{xworker:n})}const d=Ct(s,""),m=Ft(i,u,c,l,f);Wt.set(Le(e,"target",Nt),m),d&&Ot.set(e,Tt(e,d));const h=a?fetch(a).then($e):e.textContent;m.queue=m.queue.then((()=>(async(e,t,n,r)=>{const{type:s}=e,o=gt.get(s);o.experimental&&console.warn(`The ${s} interpreter is experimental`);const[a,i]=await Je([Wt.get(e).interpreter,t]);try{return Le(document,"currentScript",{configurable:!0,get:()=>e}),o.registerJSModule(a,"polyscript",{XWorker:n}),Xe(e,s),o[r?"runAsync":"run"](a,i)}finally{delete document.currentScript}})(e,h,m.XWorker,!!t)))}},Bt=new Proxy(Ce(null),{get:(e,t)=>new Promise(queueMicrotask).then((()=>Jt(t)))}),Jt=async e=>{if(It.has(e)){const{interpreter:t,queue:n}=It.get(e);return(await Je([t,n]))[0]}const t=It.size?`Available interpreters are: ${[...It.keys()].map((e=>`"${e}"`)).join(", ")}.`:"There are no interpreters in this page.";throw new Error(`The interpreter "${e}" was not found. ${t}`)},Dt=async e=>{const{type:t,currentTarget:r}=e;if(bt.length)for(let{name:s,value:o,ownerElement:a}of n(`./@*[${bt.map((e=>`name()="${e}${t}"`)).join(" or ")}]`,r)){s=s.slice(0,-(t.length+1));const n=await Jt(a.getAttribute(`${s}-env`)||s);gt.get(s).runEvent(n,o,e)}},Ht=e=>{if(bt.length)for(let{name:t,ownerElement:r}of n(`.//@*[${bt.map((e=>`starts-with(name(),"${e}")`)).join(" or ")}]`,e)){const e=t.lastIndexOf("-"),n=t.slice(e+1);"env"!==n&&(r.addEventListener(n,Dt),"disabled"in r&&!r.disabled&&(r.disabled=!0,Bt[t.slice(0,e)].then((()=>{r.disabled=!1}))))}},Ut=[],qt=new Map,Xt=new Map,zt=e=>{for(const t of Ut)if(e.matches(t)){const n=qt.get(t),{resolve:r}=Xt.get(n),{options:s,known:o}=Yt.get(n);if(!o.has(e)){o.add(e);const{interpreter:t,config:a,version:i,env:l,onInterpreterReady:c,onerror:f}=s;let u;try{const o=Mt(e);if(o){const l=Zt.call(new Pt(null,s),o,{...qe(e,n),version:i,type:t,custom:n,config:e.getAttribute("config")||a||{},async:e.hasAttribute("async")});return Le(e,"xworker",{value:l}),void r({type:n,xworker:l})}}catch(e){u=e}const p=St(t,i),d=l||`${p}${a?`|${a}`:""}`,{interpreter:m,XWorker:h}=Ft(n,d,p,i,a,t);m.then((o=>{const a=Ce(gt.get(t)),{onBeforeRun:i,onBeforeRunAsync:l,onAfterRun:d,onAfterRunAsync:m}=s,y=new Pt(o,s),g=function(...e){return h.apply(y,e)};for(const[t,[n,r]]of[["run",[i,d]]]){const s=a[t];a[t]=function(t,o,...a){n&&n.call(this,w,e);const i=s.call(this,t,o,...a);return r&&r.call(this,w,e),i}}for(const[t,[n,r]]of[["runAsync",[l,m]]]){const s=a[t];a[t]=async function(t,o,...a){n&&await n.call(this,w,e);const i=await s.call(this,t,o,...a);return r&&await r.call(this,w,e),i}}a.registerJSModule(o,"polyscript",{XWorker:g});const w={type:n,interpreter:o,XWorker:g,io:ze.get(o),config:structuredClone(wt.get(p)),run:a.run.bind(a,o),runAsync:a.runAsync.bind(a,o),runEvent:a.runEvent.bind(a,o)};r(w),u&&f?.(u,e),c?.(w,e)}))}}},Yt=new Map;let Gt=0;const Vt=(e,n)=>{let r=null==e;if(r)e="_ps"+Gt++;else if(gt.has(e)||Yt.has(e))throw new Error(`<script type="${e}"> already registered`);if(!gt.has(n?.interpreter))throw new Error("Unspecified interpreter");gt.set(e,gt.get(n.interpreter));const s=[`script[type="${e}"]`];if(Kt(e),r){const{onInterpreterReady:t}=n;n={...n,onInterpreterReady(n,r){Ut.splice(Ut.indexOf(e),1),gt.delete(e),Yt.delete(e),Xt.delete(e),r.remove(),t?.(n)}},document.head.append(Ie(document.createElement("script"),{type:e}))}else s.push(`${e}-script`),bt.push(`${e}-`);for(const t of s)qt.set(t,e);Ut.push(...s),Yt.set(e,{options:Ie({env:e},n),known:new WeakSet}),r||Ht(document),t(s.join(",")).forEach(zt)},Kt=e=>(Xt.has(e)||Xt.set(e,Promise.withResolvers()),Xt.get(e).promise),Zt=xt(),Qt=new MutationObserver((e=>{const t=_t.join(",");for(const{type:n,target:r,attributeName:s,addedNodes:o}of e)if("attributes"!==n)for(const e of o)1===e.nodeType&&(Ht(e),t&&e.matches(t)?Lt(e):en(t,e,!0));else{const e=s.lastIndexOf("-")+1;if(e){const t=s.slice(0,e);for(const n of bt)if(t===n){const t=s.slice(e);if("env"!==t){const e=r.hasAttribute(s)?"add":"remove";r[`${e}EventListener`](t,Dt)}break}}}})),en=(e,n,r)=>{e&&t(e,n).forEach(Lt),(e=Ut.join(","))&&(r&&zt(n),t(e,n).forEach(zt))},tn=e=>(Qt.observe(e,{childList:!0,subtree:!0,attributes:!0}),e),{attachShadow:nn}=Element.prototype;Ie(Element.prototype,{attachShadow(e){return tn(nn.call(this,e))}}),queueMicrotask((()=>{Ht(tn(document)),en(_t.join(","),document,!1)}));var rn=new Map([["py","pyodide"],["mpy","micropython"]]);const sn=()=>!0,on=e=>{throw new TypeError(e)},an=(e,t)=>{const n=[];if(e)for(const t of e.split(/\s*\|\s*/))"object"===t?n.push((e=>null!==e&&typeof e===t)):"null"===t?n.push((e=>null===e)):n.push((e=>typeof e===t));if(t)for(const e of[].concat(t))n.push((t=>t instanceof e));switch(n.length){case 0:return sn;case 1:return n[0];default:return e=>n.some((t=>t(e)))}},ln=(e,t,n,r=on)=>s=>{const o=[`Invalid ${typeof s} ${n}: expected `];e&&(o.push(e),t&&o.push(" or ")),t&&(o.push("an instanceof "),o.push([].concat(t).map((({name:e})=>e)).join(" | "))),r(o.join(""),s)},cn=(e=>t=>{const[n,r]=((e,t="value")=>{const n=e?.typeof,r=e?.instanceof;return[an(n,r),ln(n,r,t,e?.onerror)]})(t);return class extends e{add(e){return n(e)?super.add(e):r(e)}}})(Set),fn=cn({typeof:"function"}),un=cn({typeof:"string"});var pn={onInterpreterReady:new fn,onBeforeRun:new fn,onBeforeRunAsync:new fn,onAfterRun:new fn,onAfterRunAsync:new fn,onWorkerReady:new fn,codeBeforeRunWorker:new un,codeBeforeRunWorkerAsync:new un,codeAfterRunWorker:new un,codeAfterRunWorkerAsync:new un};const dn="py:all-done",{onAfterRun:mn,onAfterRunAsync:hn,codeAfterRunWorker:yn,codeAfterRunWorkerAsync:gn}=pn,wn=[],_n=[],bn=e=>{const t=e.hasAttribute("async"),{promise:n,resolve:r}=Promise.withResolvers(),s=`${dn}:${wn.push(n)}`;if(addEventListener(s,r,{once:!0}),e.hasAttribute("worker")){const e=`\n            from pyscript import window as _w\n            _w.dispatchEvent(_w.Event.new("${s}"))\n        `;return t?gn.add(e):yn.add(e),e}const o=(t,n)=>{n===e&&dispatchEvent(new Event(s))};return t?hn.add(o):mn.add(o),o},vn=[];for(const[e]of rn)vn.push(`script[type="${e}"]`,`${e}-script`);for(const e of document.querySelectorAll(vn.join(",")))_n.push(bn(e));Promise.all(wn).then((()=>{for(const e of _n)mn.delete(e),hn.delete(e),yn.delete(e),gn.delete(e);dispatchEvent(new Event(dn))}));var En={error:()=>import("./error-e4fe78fd.js")};const jn="PY0409",kn="PY1000",An="PY0001",Sn="PY0401",$n="PY0403",Pn="PY0404",xn="PY0500",Rn="PY0503";class Mn extends Error{constructor(e,t="",n="text"){super(`(${e}): ${t}`),this.errorCode=e,this.messageType=n,this.name="UserError"}}class Tn extends Mn{constructor(e,t){super(e,t),this.name="FetchError"}}async function On(e,t){let n;try{n=await fetch(e,t)}catch(t){const n=t;let r;throw r=e.startsWith("http")?`Fetching from URL ${e} failed with error '${n.message}'. Are your filename and path correct?`:'Polyscript: Access to local files\n        (using [[fetch]] configurations in &lt;py-config&gt;)\n        is not available when directly opening a HTML file;\n        you must use a webserver to serve the additional files.\n        See <a style="text-decoration: underline;" href="https://github.com/pyscript/pyscript/issues/257#issuecomment-1119595062">this reference</a>\n        on starting a simple webserver with Python.\n            ',new Tn(An,r)}if(!n.ok){const t=`Fetching from URL ${e} failed with error ${n.status} (${n.statusText}). Are your filename and path correct?`;switch(n.status){case 404:throw new Tn(Pn,t);case 401:throw new Tn(Sn,t);case 403:throw new Tn($n,t);case 500:throw new Tn(xn,t);case 503:throw new Tn(Rn,t);default:throw new Tn(An,t)}}return n}const Nn=async(e,t)=>{let n=e?.trim(),r="",s=!1,o=/^{/.test(n)&&/}$/.test(n);if(!o&&/\.(\w+)(?:\?\S*)?$/.test(n)){const e=RegExp.$1;"json"===e&&"toml"!==t?o=!0:"toml"===e&&"json"!==t?s=!0:((e,t="")=>{let n=`(${kn}): Invalid URL: ${e}`;throw t&&(n+=`\nexpected ${t} content`),new Error(n)})(n,t),r=n,n=(await On(r).then($e)).trim()}return{json:o,toml:s||!o&&!!n,text:n,url:r}},Wn=(e,t,{message:n})=>{let r=`(${kn}): Invalid ${e}`;return t&&(r+=` @ ${t}`),new SyntaxError(`${r}\n${n}`)},In=new Map;for(const[t]of rn){let n,r,s,o,a,i=e(`${t}-config`);if(i?(o=i.getAttribute("src")||i.textContent,a=i.getAttribute("type")):(i=e([`script[type="${t}"][config]:not([worker])`,`${t}-script[config]:not([worker])`].join(",")),i&&(o=i.getAttribute("config"))),o)try{const{json:e,toml:t,text:n,url:i}=await Nn(o,a);if(o=n,e||"json"===a)try{r=JSON.parse(n)}catch(e){s=Wn("JSON",i,e)}else if(t||"toml"===a)try{const{parse:e}=await import("https://cdn.jsdelivr.net/npm/@webreflection/toml-j0.4/toml.js");r=e(n)}catch(e){s=Wn("TOML",i,e)}}catch(e){s=e}const l=[];for(const[e,t]of Object.entries(En))s?"error"===e&&t().then((({notify:e})=>e(s.message))):r?.plugins?.includes(`!${e}`)||l.push(t());l.length&&(n=Promise.all(l)),In.set(t,{config:r,plugins:n,error:s})}var Cn={sleep:e=>new Promise((t=>setTimeout(t,1e3*e)))};const{entries:Fn}=Object,Ln=["from pathlib import Path as _Path"],Bn=(e,t)=>{for(const[n,r]of Fn(t)){const t=`_Path("${e}/${n}")`;if("string"==typeof r){const e=JSON.stringify(r);Ln.push(`${t}.write_text(${e})`)}else Ln.push(`${t}.mkdir(parents=True, exist_ok=True)`),Bn(`${e}/${n}`,r)}};Bn(".",{pyscript:{"__init__.py":'# Some notes about the naming conventions and the relationship between various\n# similar-but-different names.\n#\n# import pyscript\n#     this package contains the main user-facing API offered by pyscript. All\n#     the names which are supposed be used by end users should be made\n#     available in pyscript/__init__.py (i.e., this file)\n#\n# import _pyscript\n#     this is an internal module implemented in JS. It is used internally by\n#     the pyscript package, end users should not use it directly. For its\n#     implementation, grep for `interpreter.registerJsModule("_pyscript",\n#     ...)` in core.js\n#\n# import js\n#     this is the JS globalThis, as exported by pyodide and/or micropython\'s\n#     FFIs. As such, it contains different things in the main thread or in a\n#     worker.\n#\n# import pyscript.magic_js\n#     this submodule abstracts away some of the differences between the main\n#     thread and the worker. In particular, it defines `window` and `document`\n#     in such a way that these names work in both cases: in the main thread,\n#     they are the "real" objects, in the worker they are proxies which work\n#     thanks to coincident.\n#\n# from pyscript import window, document\n#     these are just the window and document objects as defined by\n#     pyscript.magic_js. This is the blessed way to access them from pyscript,\n#     as it works transparently in both the main thread and worker cases.\n\nfrom pyscript.magic_js import RUNNING_IN_WORKER, window, document, sync\nfrom pyscript.display import HTML, display\n\ntry:\n    from pyscript.event_handling import when\nexcept:\n    from pyscript.util import NotSupported\n\n    when = NotSupported(\n        "pyscript.when",\n        "pyscript.when currently not available with this interpreter"\n    )\n',"display.py":'import base64\nimport html\nimport io\nimport re\n\nfrom pyscript.magic_js import document, window, current_target\n\n_MIME_METHODS = {\n    "__repr__": "text/plain",\n    "_repr_html_": "text/html",\n    "_repr_markdown_": "text/markdown",\n    "_repr_svg_": "image/svg+xml",\n    "_repr_pdf_": "application/pdf",\n    "_repr_jpeg_": "image/jpeg",\n    "_repr_png_": "image/png",\n    "_repr_latex": "text/latex",\n    "_repr_json_": "application/json",\n    "_repr_javascript_": "application/javascript",\n    "savefig": "image/png",\n}\n\n\ndef _render_image(mime, value, meta):\n    # If the image value is using bytes we should convert it to base64\n    # otherwise it will return raw bytes and the browser will not be able to\n    # render it.\n    if isinstance(value, bytes):\n        value = base64.b64encode(value).decode("utf-8")\n\n    # This is the pattern of base64 strings\n    base64_pattern = re.compile(\n        r"^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"\n    )\n    # If value doesn\'t match the base64 pattern we should encode it to base64\n    if len(value) > 0 and not base64_pattern.match(value):\n        value = base64.b64encode(value.encode("utf-8")).decode("utf-8")\n\n    data = f"data:{mime};charset=utf-8;base64,{value}"\n    attrs = " ".join([\'{k}="{v}"\' for k, v in meta.items()])\n    return f\'<img src="{data}" {attrs}></img>\'\n\n\ndef _identity(value, meta):\n    return value\n\n\n_MIME_RENDERERS = {\n    "text/plain": html.escape,\n    "text/html": _identity,\n    "image/png": lambda value, meta: _render_image("image/png", value, meta),\n    "image/jpeg": lambda value, meta: _render_image("image/jpeg", value, meta),\n    "image/svg+xml": _identity,\n    "application/json": _identity,\n    "application/javascript": lambda value, meta: f"<script>{value}<\\\\/script>",\n}\n\n\nclass HTML:\n    """\n    Wrap a string so that display() can render it as plain HTML\n    """\n\n    def __init__(self, html):\n        self._html = html\n\n    def _repr_html_(self):\n        return self._html\n\n\ndef _eval_formatter(obj, print_method):\n    """\n    Evaluates a formatter method.\n    """\n    if print_method == "__repr__":\n        return repr(obj)\n    elif hasattr(obj, print_method):\n        if print_method == "savefig":\n            buf = io.BytesIO()\n            obj.savefig(buf, format="png")\n            buf.seek(0)\n            return base64.b64encode(buf.read()).decode("utf-8")\n        return getattr(obj, print_method)()\n    elif print_method == "_repr_mimebundle_":\n        return {}, {}\n    return None\n\n\ndef _format_mime(obj):\n    """\n    Formats object using _repr_x_ methods.\n    """\n    if isinstance(obj, str):\n        return html.escape(obj), "text/plain"\n\n    mimebundle = _eval_formatter(obj, "_repr_mimebundle_")\n    if isinstance(mimebundle, tuple):\n        format_dict, _ = mimebundle\n    else:\n        format_dict = mimebundle\n\n    output, not_available = None, []\n    for method, mime_type in reversed(_MIME_METHODS.items()):\n        if mime_type in format_dict:\n            output = format_dict[mime_type]\n        else:\n            output = _eval_formatter(obj, method)\n\n        if output is None:\n            continue\n        elif mime_type not in _MIME_RENDERERS:\n            not_available.append(mime_type)\n            continue\n        break\n    if output is None:\n        if not_available:\n            window.console.warn(\n                f"Rendered object requested unavailable MIME renderers: {not_available}"\n            )\n        output = repr(output)\n        mime_type = "text/plain"\n    elif isinstance(output, tuple):\n        output, meta = output\n    else:\n        meta = {}\n    return _MIME_RENDERERS[mime_type](output, meta), mime_type\n\n\ndef _write(element, value, append=False):\n    html, mime_type = _format_mime(value)\n    if html == "\\\\n":\n        return\n\n    if append:\n        out_element = document.createElement("div")\n        element.append(out_element)\n    else:\n        out_element = element.lastElementChild\n        if out_element is None:\n            out_element = element\n\n    if mime_type in ("application/javascript", "text/html"):\n        script_element = document.createRange().createContextualFragment(html)\n        out_element.append(script_element)\n    else:\n        out_element.innerHTML = html\n\n\ndef display(*values, target=None, append=True):\n    if target is None:\n        target = current_target()\n\n    element = document.getElementById(target)\n\n    # if element is a <script type="py">, it has a \'target\' attribute which\n    # points to the visual element holding the displayed values. In that case,\n    # use that.\n    if element.tagName == \'SCRIPT\' and hasattr(element, \'target\'):\n        element = element.target\n\n    for v in values:\n        _write(element, v, append=append)\n',"event_handling.py":'import inspect\n\nfrom pyodide.ffi.wrappers import add_event_listener\nfrom pyscript.magic_js import document\n\n\ndef when(event_type=None, selector=None):\n    """\n    Decorates a function and passes py-* events to the decorated function\n    The events might or not be an argument of the decorated function\n    """\n\n    def decorator(func):\n        if isinstance(selector, str):\n            elements = document.querySelectorAll(selector)\n        else:\n            # TODO: This is a hack that will be removed when pyscript becomes a package\n            #       and we can better manage the imports without circular dependencies\n            from pyweb import pydom\n\n            if isinstance(selector, pydom.Element):\n                elements = [selector._js]\n            elif isinstance(selector, pydom.ElementCollection):\n                elements = [el._js for el in selector]\n            else:\n                raise ValueError(\n                    f"Invalid selector: {selector}. Selector must"\n                    " be a string, a pydom.Element or a pydom.ElementCollection."\n                )\n\n        sig = inspect.signature(func)\n        # Function doesn\'t receive events\n        if not sig.parameters:\n\n            def wrapper(*args, **kwargs):\n                func()\n\n            for el in elements:\n                add_event_listener(el, event_type, wrapper)\n        else:\n            for el in elements:\n                add_event_listener(el, event_type, func)\n        return func\n\n    return decorator\n',"magic_js.py":"from pyscript.util import NotSupported\nimport js as globalThis\n\nRUNNING_IN_WORKER = not hasattr(globalThis, \"document\")\n\nif RUNNING_IN_WORKER:\n    import polyscript\n\n    PyWorker = NotSupported(\n        'pyscript.PyWorker',\n        'pyscript.PyWorker works only when running in the main thread')\n    window = polyscript.xworker.window\n    document = window.document\n    sync = polyscript.xworker.sync\n\n    # in workers the display does not have a default ID\n    # but there is a sync utility from xworker\n    def current_target():\n        return polyscript.target\n\nelse:\n    import _pyscript\n    from _pyscript import PyWorker\n    window = globalThis\n    document = globalThis.document\n    sync = NotSupported(\n        'pyscript.sync',\n        'pyscript.sync works only when running in a worker')\n\n    # in MAIN the current element target exist, just use it\n    def current_target():\n        return _pyscript.target\n","util.py":'class NotSupported:\n    """\n    Small helper that raises exceptions if you try to get/set any attribute on\n    it.\n    """\n\n    def __init__(self, name, error):\n        object.__setattr__(self, "name", name)\n        object.__setattr__(self, "error", error)\n\n    def __repr__(self):\n        return f"<NotSupported {self.name} [{self.error}]>"\n\n    def __getattr__(self, attr):\n        raise AttributeError(self.error)\n\n    def __setattr__(self, attr, value):\n        raise AttributeError(self.error)\n\n    def __call__(self, *args):\n        raise TypeError(self.error)\n'},pyweb:{"pydom.py":'import sys\nimport warnings\nfrom functools import cached_property\nfrom typing import Any\n\nfrom pyodide.ffi import JsProxy\nfrom pyscript import display, document, window\n\n# from pyscript import when as _when\n\nalert = window.alert\n\n\nclass BaseElement:\n    def __init__(self, js_element):\n        self._js = js_element\n        self._parent = None\n        self.style = StyleProxy(self)\n\n    def __eq__(self, obj):\n        """Check if the element is the same as the other element by comparing\n        the underlying JS element"""\n        return isinstance(obj, BaseElement) and obj._js == self._js\n\n    @property\n    def parent(self):\n        if self._parent:\n            return self._parent\n\n        if self._js.parentElement:\n            self._parent = self.__class__(self._js.parentElement)\n\n        return self._parent\n\n    @property\n    def __class(self):\n        return self.__class__ if self.__class__ != PyDom else Element\n\n    def create(self, type_, is_child=True, classes=None, html=None, label=None):\n        js_el = document.createElement(type_)\n        element = self.__class(js_el)\n\n        if classes:\n            for class_ in classes:\n                element.add_class(class_)\n\n        if html is not None:\n            element.html = html\n\n        if label is not None:\n            element.label = label\n\n        if is_child:\n            self.append(element)\n\n        return element\n\n    def find(self, selector):\n        """Return an ElementCollection representing all the child elements that\n        match the specified selector.\n\n        Args:\n            selector (str): A string containing a selector expression\n\n        Returns:\n            ElementCollection: A collection of elements matching the selector\n        """\n        elements = self._js.querySelectorAll(selector)\n        if not elements:\n            return None\n        return ElementCollection([Element(el) for el in elements])\n\n\nclass Element(BaseElement):\n    @property\n    def children(self):\n        return [self.__class__(el) for el in self._js.children]\n\n    def append(self, child):\n        # TODO: this is Pyodide specific for now!!!!!!\n        # if we get passed a JSProxy Element directly we just map it to the\n        # higher level Python element\n        if isinstance(child, JsProxy):\n            return self.append(Element(child))\n\n        elif isinstance(child, Element):\n            self._js.appendChild(child._js)\n\n            return child\n\n        elif isinstance(child, ElementCollection):\n            for el in child:\n                self.append(el)\n\n    # -------- Pythonic Interface to Element -------- #\n    @property\n    def html(self):\n        return self._js.innerHTML\n\n    @html.setter\n    def html(self, value):\n        self._js.innerHTML = value\n\n    @property\n    def content(self):\n        # TODO: This breaks with with standard template elements. Define how to best\n        #       handle this specifica use case. Just not support for now?\n        if self._js.tagName == "TEMPLATE":\n            warnings.warn(\n                "Content attribute not supported for template elements.", stacklevel=2\n            )\n            return None\n        return self._js.innerHTML\n\n    @content.setter\n    def content(self, value):\n        # TODO: (same comment as above)\n        if self._js.tagName == "TEMPLATE":\n            warnings.warn(\n                "Content attribute not supported for template elements.", stacklevel=2\n            )\n            return\n\n        display(value, target=self.id)\n\n    @property\n    def id(self):\n        return self._js.id\n\n    @id.setter\n    def id(self, value):\n        self._js.id = value\n\n    def clone(self, new_id=None):\n        clone = Element(self._js.cloneNode(True))\n        clone.id = new_id\n\n        return clone\n\n    def remove_class(self, classname):\n        classList = self._js.classList\n        if isinstance(classname, list):\n            classList.remove(*classname)\n        else:\n            classList.remove(classname)\n        return self\n\n    def add_class(self, classname):\n        classList = self._js.classList\n        if isinstance(classname, list):\n            classList.add(*classname)\n        else:\n            self._js.classList.add(classname)\n        return self\n\n    @property\n    def classes(self):\n        classes = self._js.classList.values()\n        return [x for x in classes]\n\n    def show_me(self):\n        self._js.scrollIntoView()\n\n    def when(self, event, handler):\n        document.when(event, selector=self)(handler)\n\n\nclass StyleProxy(dict):\n    def __init__(self, element: Element) -> None:\n        self._element = element\n\n    @cached_property\n    def _style(self):\n        return self._element._js.style\n\n    def __getitem__(self, key):\n        return self._style.getPropertyValue(key)\n\n    def __setitem__(self, key, value):\n        self._style.setProperty(key, value)\n\n    def remove(self, key):\n        self._style.removeProperty(key)\n\n    def set(self, **kws):\n        for k, v in kws.items():\n            self._element._js.style.setProperty(k, v)\n\n    # CSS Properties\n    # Reference: https://github.com/microsoft/TypeScript/blob/main/src/lib/dom.generated.d.ts#L3799C1-L5005C2\n    # Following prperties automatically generated from the above reference using\n    # tools/codegen_css_proxy.py\n    @property\n    def visible(self):\n        return self._element._js.style.visibility\n\n    @visible.setter\n    def visible(self, value):\n        self._element._js.style.visibility = value\n\n\nclass StyleCollection:\n    def __init__(self, collection: "ElementCollection") -> None:\n        self._collection = collection\n\n    def __get__(self, obj, objtype=None):\n        return obj._get_attribute("style")\n\n    def __getitem__(self, key):\n        return self._collection._get_attribute("style")[key]\n\n    def __setitem__(self, key, value):\n        for element in self._collection._elements:\n            element.style[key] = value\n\n    def remove(self, key):\n        for element in self._collection._elements:\n            element.style.remove(key)\n\n\nclass ElementCollection:\n    def __init__(self, elements: [Element]) -> None:\n        self._elements = elements\n        self.style = StyleCollection(self)\n\n    def __getitem__(self, key):\n        # If it\'s an integer we use it to access the elements in the collection\n        if isinstance(key, int):\n            return self._elements[key]\n        # If it\'s a slice we use it to support slice operations over the elements\n        # in the collection\n        elif isinstance(key, slice):\n            return ElementCollection(self._elements[key])\n\n        # If it\'s anything else (basically a string) we use it as a selector\n        # TODO: Write tests!\n        elements = self._element.querySelectorAll(key)\n        return ElementCollection([Element(el) for el in elements])\n\n    def __len__(self):\n        return len(self._elements)\n\n    def __eq__(self, obj):\n        """Check if the element is the same as the other element by comparing\n        the underlying JS element"""\n        return isinstance(obj, ElementCollection) and obj._elements == self._elements\n\n    def _get_attribute(self, attr, index=None):\n        if index is None:\n            return [getattr(el, attr) for el in self._elements]\n\n        # As JQuery, when getting an attr, only return it for the first element\n        return getattr(self._elements[index], attr)\n\n    def _set_attribute(self, attr, value):\n        for el in self._elements:\n            setattr(el, attr, value)\n\n    @property\n    def html(self):\n        return self._get_attribute("html")\n\n    @html.setter\n    def html(self, value):\n        self._set_attribute("html", value)\n\n    @property\n    def children(self):\n        return self._elements\n\n    def __iter__(self):\n        yield from self._elements\n\n    def __repr__(self):\n        return f"{self.__class__.__name__} (length: {len(self._elements)}) {self._elements}"\n\n\nclass DomScope:\n    def __getattr__(self, __name: str) -> Any:\n        element = document[f"#{__name}"]\n        if element:\n            return element[0]\n\n\nclass PyDom(BaseElement):\n    # Add objects we want to expose to the DOM namespace since this class instance is being\n    # remapped as "the module" itself\n    BaseElement = BaseElement\n    Element = Element\n    ElementCollection = ElementCollection\n\n    def __init__(self):\n        super().__init__(document)\n        self.ids = DomScope()\n        self.body = Element(document.body)\n        self.head = Element(document.head)\n\n    def create(self, type_, parent=None, classes=None, html=None):\n        return super().create(type_, is_child=False)\n\n    def __getitem__(self, key):\n        if isinstance(key, int):\n            indices = range(*key.indices(len(self.list)))\n            return [self.list[i] for i in indices]\n\n        elements = self._js.querySelectorAll(key)\n        if not elements:\n            return None\n        return ElementCollection([Element(el) for el in elements])\n\n\ndom = PyDom()\n\nsys.modules[__name__] = dom\n'}}),Ln.push("del _Path"),Ln.push("\n");var Jn=Ln.join("\n");
/*! (c) PyScript Development Team */const{assign:Dn,defineProperty:Hn}=Object;let Un;const qn=({tagName:e})=>"SCRIPT"===e,Xn=e=>{Hn(document,"currentScript",{configurable:!0,get:()=>e})},zn=()=>{delete document.currentScript},Yn=(e,t,n,r)=>{n(t);for(const n of pn[r])n(e,t)};let Gn=!0;const Vn=({XWorker:e,interpreter:t,io:n})=>{t.registerJsModule("_pyscript",{PyWorker:function(...t){const r=e(...t);return r.onerror=({error:e})=>n.stderr(e),r},get target(){return qn(Un)?Un.target.id:Un.id}}),t.runPython(Jn,{globals:t.runPython("{}")})},Kn={codeBeforeRunWorker:()=>[Jn,...pn.codeBeforeRunWorker].map(xe).join("\n"),codeBeforeRunWorkerAsync:()=>[Jn,...pn.codeBeforeRunWorkerAsync].map(xe).join("\n"),codeAfterRunWorker:()=>[...pn.codeAfterRunWorker].map(xe).join("\n"),codeAfterRunWorkerAsync:()=>[...pn.codeAfterRunWorkerAsync].map(xe).join("\n")},Zn={};for(const[e,t]of rn){const{config:n,plugins:r,error:s}=In.get(e);let o=0;const a=(t=e)=>`${t}-${o++}`,i=async(t,n,r)=>{if(t.hasAttribute("src"))try{return await On(t.getAttribute("src")).then($e)}catch(e){n.stderr(e)}if(r)return xe(t.textContent);const s=xe(Ne(t.innerHTML));return console.warn(`Deprecated: use <script type="${e}"> for an always safe content parsing:\n`,s),s};if(!s){const s=new Map;Vt(e,{config:n,interpreter:t,env:`${e}-script`,version:n?.interpreter,onerror(e,t){s.set(t,e)},...Kn,onWorkerReady(e,t){Dn(t.sync,Cn);for(const n of pn.onWorkerReady)n(e,t)},onBeforeRun(e,t){Un=t,Yn(e,t,Xn,"onBeforeRun")},onBeforeRunAsync(e,t){Un=t,Yn(e,t,Xn,"onBeforeRunAsync")},onAfterRun(e,t){Yn(e,t,zn,"onAfterRun")},onAfterRunAsync(e,t){Yn(e,t,zn,"onAfterRunAsync")},async onInterpreterReady(t,n){Gn&&(Gn=!1,Vn(t)),r&&await r;for(const e of pn.onInterpreterReady)e(t,n);if(s.has(n)){let{message:e}=s.get(n);s.delete(n);const r=e===Rt;return e=`(${jn}) ${e} for `,e+=n.cloneNode(r).outerHTML,void t.io.stderr(e)}if(qn(n)){const{attributes:{async:r,target:s}}=n,o=!!s?.value,l=o?Tt(n,s.value):document.createElement("script-py");if(!o){const{head:e,body:t}=document;e.contains(n)?t.append(l):n.after(l)}l.id||(l.id=a()),Hn(n,"target",{value:l}),Xe(n,e),t["run"+(r?"Async":"")](await i(n,t.io,!0))}else n._wrap.resolve(t);console.debug("[pyscript/main] PyScript Ready")}})}class l extends HTMLElement{constructor(){Dn(super(),{_wrap:Promise.withResolvers(),srcCode:"",executed:!1})}get _pyodide(){return this._wrap}get id(){return super.id||(super.id=a())}set id(e){super.id=e}async connectedCallback(){if(!this.executed){this.executed=!0;const{io:t,run:n,runAsync:r}=await this._wrap.promise,s=this.hasAttribute("async")?r:n;this.srcCode=await i(this,t,!this.childElementCount),this.replaceChildren(),Xe(this,e),s(this.srcCode),this.style.display="block"}}}s||customElements.define(`${e}-script`,l),Zn[e]=structuredClone(n)}function Qn(e,t){const n=Zt.call(new Pt(null,Kn),e,{...t,type:"pyodide"});return Dn(n.sync,Cn),n}export{Qn as PyWorker,Zn as config,pn as hooks};
//# sourceMappingURL=core.js.map